<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Science Lab Mini - WonderKids</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        :root {
            --lab-bg: #f0f4f8;
            --table-top: #cfd8dc;
            --primary: #9c27b0;
            --secondary: #00bcd4;
            --glass: rgba(255, 255, 255, 0.4);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Fredoka', sans-serif;
            user-select: none;
        }

        body {
            height: 100vh;
            width: 100vw;
            overflow: hidden;
            background: var(--lab-bg);
            display: flex;
            flex-direction: column;
        }

        header {
            padding: 20px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: white;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
            z-index: 10;
        }

        .back-btn {
            background: #fff;
            border: 2px solid #eee;
            color: #ff4d4d;
            padding: 10px 20px;
            border-radius: 15px;
            cursor: pointer;
            font-weight: 600;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .game-title {
            font-size: 1.8rem;
            color: #37474f;
            font-weight: 700;
        }

        /* Lab Setup */
        main {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            background-image:
                radial-gradient(#cfd8dc 1px, transparent 1px),
                radial-gradient(#cfd8dc 1px, transparent 1px);
            background-size: 40px 40px;
            background-position: 0 0, 20px 20px;
        }

        .lab-table {
            width: 80%;
            height: 400px;
            background: #b0bec5;
            border-radius: 40px;
            border-bottom: 20px solid #90a4ae;
            position: relative;
            display: flex;
            justify-content: space-around;
            align-items: flex-end;
            padding: 40px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }

        /* Mix Beaker */
        .mix-area {
            position: absolute;
            top: -150px;
            left: 50%;
            transform: translateX(-50%);
            width: 200px;
            height: 250px;
            background: var(--glass);
            border: 4px solid #fff;
            border-top: none;
            border-radius: 0 0 100px 100px;
            backdrop-filter: blur(5px);
            display: flex;
            align-items: flex-end;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.05);
        }

        .liquid {
            width: 100%;
            height: 0%;
            transition: height 0.5s ease;
            position: relative;
        }

        .bubbles {
            position: absolute;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        .bubble {
            position: absolute;
            background: rgba(255, 255, 255, 0.4);
            border-radius: 50%;
            animation: rise 2s infinite;
        }

        @keyframes rise {
            0% {
                transform: translateY(0) scale(1);
                opacity: 0;
            }

            50% {
                opacity: 0.7;
            }

            100% {
                transform: translateY(-200px) scale(0.5);
                opacity: 0;
            }
        }

        /* Ingredients */
        .shelf {
            display: flex;
            gap: 30px;
            z-index: 5;
        }

        .test-tube {
            width: 60px;
            height: 180px;
            background: var(--glass);
            border: 3px solid #fff;
            border-top: none;
            border-radius: 0 0 30px 30px;
            cursor: pointer;
            position: relative;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            display: flex;
            align-items: flex-end;
            overflow: hidden;
        }

        .test-tube:hover {
            transform: translateY(-15px) rotate(5deg);
        }

        .test-tube.pouring {
            transform: translate(150px, -250px) rotate(120deg) !important;
        }

        .tube-liquid {
            width: 100%;
            height: 70%;
        }

        .tube-label {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            font-weight: 700;
            color: #fff;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
            text-align: center;
            width: 100%;
            font-size: 0.8rem;
        }

        /* Overlay */
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(10px);
        }

        .overlay.active {
            display: flex;
        }

        .science-card {
            background: white;
            padding: 40px;
            border-radius: 40px;
            text-align: center;
            max-width: 500px;
            width: 90%;
            border: 10px solid var(--secondary);
        }

        .science-card h2 {
            font-size: 2.5rem;
            color: var(--primary);
            margin-bottom: 20px;
        }

        .science-card p {
            font-size: 1.1rem;
            color: #555;
            line-height: 1.6;
            margin-bottom: 30px;
        }

        .btn-reset {
            background: var(--primary);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.2rem;
            font-weight: 700;
            border-radius: 50px;
            cursor: pointer;
        }

        /* Explosion */
        .explosion {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            width: 400px;
            height: 400px;
            background: radial-gradient(circle, #ffeb3b 0%, #ff5722 50%, transparent 70%);
            border-radius: 50%;
            z-index: 20;
            pointer-events: none;
            opacity: 0;
        }

        .explosion.animate {
            animation: explo 0.8s ease-out forwards;
        }

        @keyframes explo {
            0% {
                transform: translate(-50%, -50%) scale(0);
                opacity: 0;
            }

            50% {
                opacity: 1;
            }

            100% {
                transform: translate(-50%, -50%) scale(2);
                opacity: 0;
            }
        }
    </style>
</head>

<body>

    <header>
        <a href="index.html" class="back-btn"><i class="fa-solid fa-arrow-left"></i> Home</a>
        <h1 class="game-title">Science Lab Mini</h1>
        <div style="width: 100px;"></div>
    </header>

    <main>
        <div class="lab-table">
            <div class="mix-area" id="mixArea">
                <div class="liquid" id="mixLiquid">
                    <div class="bubbles" id="bubbles"></div>
                </div>
            </div>

            <div class="shelf" id="shelf">
                <!-- Ingredients injected here -->
            </div>
        </div>

        <div class="explosion" id="explosion"></div>
    </main>

    <div class="overlay" id="resultOverlay">
        <div class="science-card">
            <div id="resultEmoji" style="font-size: 5rem; margin-bottom: 10px;">ðŸ§ª</div>
            <h2 id="resultTitle">Reaction!</h2>
            <p id="resultText">You mixed some cool things!</p>
            <button class="btn-reset" onclick="resetLab()">Try Again!</button>
        </div>
    </div>

    <script>
        const chemicals = [
            { id: 'baking-soda', name: 'Baking Soda', color: '#ffffff', label: 'Baking Soda' },
            { id: 'vinegar', name: 'Vinegar', color: '#ffeb3b', label: 'Vinegar' },
            { id: 'food-color', name: 'Red Dye', color: '#f44336', label: 'Red Dye' },
            { id: 'water', name: 'Blue Water', color: '#2196f3', label: 'Water' }
        ];

        const reactions = [
            {
                combo: ['baking-soda', 'vinegar'],
                title: 'Fizzy Volcano!',
                text: 'Mixing Baking Soda (a base) with Vinegar (an acid) creates Carbon Dioxide gas. That\'s why it bubbles up!',
                emoji: 'ðŸŒ‹',
                color: '#fff9c4'
            },
            {
                combo: ['water', 'food-color'],
                title: 'Color Mixing!',
                text: 'See how the molecules of red dye spread through the water? Scientists call this Diffusion!',
                emoji: 'ðŸŽ¨',
                color: '#ef5350'
            },
            {
                combo: ['baking-soda', 'food-color', 'vinegar'],
                title: 'Lava Eruption!',
                text: 'You made a red, bubbly eruption! The color makes it look like real lava from a volcano.',
                emoji: 'ðŸ”¥',
                color: '#d32f2f'
            }
        ];

        let currentMix = [];
        let isPouring = false;

        function initLab() {
            const shelf = document.getElementById('shelf');
            shelf.innerHTML = '';
            chemicals.forEach(chem => {
                const tube = document.createElement('div');
                tube.className = 'test-tube';
                tube.innerHTML = `
                    <div class="tube-label">${chem.label}</div>
                    <div class="tube-liquid" style="background: ${chem.color}"></div>
                `;
                tube.onclick = () => pour(chem);
                shelf.appendChild(tube);
            });
        }

        function pour(chem) {
            if (isPouring) return;
            isPouring = true;

            currentMix.push(chem.id);

            // Visual pour
            const mixLiquid = document.getElementById('mixLiquid');
            const newHeight = Math.min(currentMix.length * 25, 90);
            mixLiquid.style.height = newHeight + '%';
            mixLiquid.style.background = chem.color;

            // Simple bubble effect
            createBubbles();

            // Check for reaction
            setTimeout(() => {
                isPouring = false;
                checkReactions();
            }, 600);
        }

        function createBubbles() {
            const container = document.getElementById('bubbles');
            for (let i = 0; i < 5; i++) {
                const b = document.createElement('div');
                b.className = 'bubble';
                b.style.left = Math.random() * 80 + 10 + '%';
                b.style.width = Math.random() * 15 + 5 + 'px';
                b.style.height = b.style.width;
                container.appendChild(b);
                setTimeout(() => b.remove(), 2000);
            }
        }

        function checkReactions() {
            const match = reactions.find(r =>
                r.combo.every(ing => currentMix.includes(ing)) &&
                r.combo.length === currentMix.length
            );

            // Special case: if we have 3 ingredients and they match the 3-ing combo
            const complexMatch = reactions.find(r =>
                r.combo.length === 3 &&
                r.combo.every(ing => currentMix.includes(ing))
            );

            const activeMatch = complexMatch || match;

            if (activeMatch) {
                if (activeMatch.title.includes('Volcano') || activeMatch.title.includes('Lava')) {
                    triggerExplosion();
                }
                setTimeout(() => showResult(activeMatch), 1000);
            } else if (currentMix.length >= 3) {
                showResult({
                    title: 'Mixed Up!',
                    text: 'You mixed a lot of things! In science, some things react and others just mix together.',
                    emoji: 'ðŸ§ª',
                    color: '#9c27b0'
                });
            }
        }

        function triggerExplosion() {
            const e = document.getElementById('explosion');
            e.classList.add('animate');
            setTimeout(() => e.classList.remove('animate'), 1000);

            confetti({
                particleCount: 100,
                spread: 70,
                origin: { y: 0.4 }
            });
        }

        function showResult(reaction) {
            document.getElementById('resultTitle').innerText = reaction.title;
            document.getElementById('resultText').innerText = reaction.text;
            document.getElementById('resultEmoji').innerText = reaction.emoji;
            document.getElementById('resultOverlay').classList.add('active');
            playSuccessSound();
        }

        function resetLab() {
            currentMix = [];
            document.getElementById('mixLiquid').style.height = '0%';
            document.getElementById('resultOverlay').classList.remove('active');
        }

        function playSuccessSound() {
            // Placeholder for sound logic
        }

        initLab();
    </script>
</body>

</html>