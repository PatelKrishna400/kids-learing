<!DOCTYPE html>
<html class="light" lang="en">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Alphabet Balloon Pop - WonderKids</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@400;500;700;800;900&amp;display=swap"
        rel="stylesheet" />
    <link
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap"
        rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script src="voice-engine.js"></script>
    <script id="tailwind-config">
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#258cf4",
                        "background-light": "#f5f7f8",
                        "background-dark": "#101922",
                        "wood-light": "#d97706",
                        "wood-dark": "#92400e",
                        "sky-blue": "#bae6fd",
                        "game-green": "#22c55e",
                        "game-blue": "#3b82f6",
                    },
                    fontFamily: {
                        "display": ["Be Vietnam Pro", "sans-serif"]
                    },
                    borderRadius: { "DEFAULT": "1rem", "lg": "2rem", "xl": "3rem", "full": "9999px" },
                },
            },
        }
    </script>
    <style>
        .material-symbols-outlined {
            font-variation-settings: 'FILL' 1, 'wght' 400, 'GRAD' 0, 'opsz' 24;
        }

        .sky-gradient {
            background: linear-gradient(to bottom, #4facfe 0%, #00f2fe 100%);
        }

        .wood-texture {
            background-color: #926239;
            background-image: repeating-linear-gradient(45deg, transparent, transparent 10px, rgba(0, 0, 0, 0.05) 10px, rgba(0, 0, 0, 0.05) 20px);
            border: 4px solid #5d3f24;
            box-shadow: inset 0 0 15px rgba(0, 0, 0, 0.3);
        }

        .wood-texture-plank {
            background-image: linear-gradient(rgba(146, 64, 14, 0.1) 1px, transparent 1px),
                linear-gradient(90deg, rgba(146, 64, 14, 0.1) 1px, transparent 1px);
            background-size: 20px 20px;
        }

        .balloon-float {
            animation: float 6s ease-in-out infinite;
        }

        @keyframes float {

            0%,
            100% {
                transform: translateY(0) rotate(-2deg);
            }

            50% {
                transform: translateY(-20px) rotate(2deg);
            }
        }

        .cursor-pin {
            cursor: crosshair;
        }

        .balloon {
            transition: transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            user-select: none;
        }

        .bubbly-text {
            text-shadow: 2px 2px 0px rgba(0, 0, 0, 0.1);
        }

        .floating {
            animation: boardFloat 6s ease-in-out infinite;
        }

        @keyframes boardFloat {
            0% {
                transform: translateY(0px);
            }

            50% {
                transform: translateY(-10px);
            }

            100% {
                transform: translateY(0px);
            }
        }

        .pop-animation {
            animation: pop 0.3s forwards;
        }

        @keyframes pop {
            0% {
                transform: scale(1);
                opacity: 1;
            }

            100% {
                transform: scale(2);
                opacity: 0;
            }
        }
    </style>
</head>

<body class="font-display bg-background-light dark:bg-background-dark overflow-hidden cursor-pin">
    <div class="relative h-screen w-full sky-gradient overflow-hidden flex flex-col" id="gameArea">

        <!-- START SCREEN -->
        <div id="startScreen"
            class="absolute inset-0 z-50 flex items-center justify-center bg-black/20 backdrop-blur-sm">
            <div
                class="bg-white p-12 rounded-3xl shadow-2xl text-center flex flex-col items-center gap-8 border-8 border-primary max-w-md">
                <div class="text-7xl">üéà</div>
                <h1 class="text-primary text-5xl font-black uppercase">Balloon Pop!</h1>
                <p class="text-slate-600 font-bold">Pop the matching letters as they float to the sky!</p>
                <button onclick="startGame()"
                    class="bg-primary text-white text-2xl font-black px-12 py-5 rounded-full shadow-xl hover:scale-110 active:scale-95 transition-all">
                    START ADVENTURE
                </button>
            </div>
        </div>

        <!-- GAME HUD -->
        <header class="relative z-20 flex items-center justify-between px-8 py-6">
            <div class="flex gap-4">
                <button onclick="window.location.href='index.html'"
                    class="flex items-center justify-center size-14 rounded-full bg-white/90 text-primary shadow-lg hover:scale-105 transition-transform pointer-events-auto">
                    <span class="material-symbols-outlined text-3xl">home</span>
                </button>
                <button id="speakerBtn"
                    class="flex items-center justify-center size-14 rounded-full bg-white/90 text-primary shadow-lg hover:scale-105 transition-transform pointer-events-auto">
                    <span class="material-symbols-outlined text-3xl">volume_up</span>
                </button>
            </div>

            <div class="absolute left-1/2 -translate-x-1/2 top-4 pointer-events-none">
                <div
                    class="wood-texture px-12 py-4 rounded-xl flex flex-col items-center shadow-2xl border-b-8 border-r-4">
                    <span class="text-white text-sm font-bold uppercase tracking-widest opacity-80">Pop the
                        Letter</span>
                    <span class="text-white text-7xl font-black drop-shadow-md" id="targetLetterDisplay">?</span>
                </div>
                <div class="absolute -top-10 left-10 w-1 h-10 bg-slate-700/30"></div>
                <div class="absolute -top-10 right-10 w-1 h-10 bg-slate-700/30"></div>
            </div>

            <div class="flex gap-4">
                <div
                    class="flex items-center gap-3 bg-white/90 px-6 py-3 rounded-full shadow-lg border-2 border-primary/20">
                    <span class="material-symbols-outlined text-primary text-3xl">stars</span>
                    <div class="flex flex-col">
                        <span class="text-[10px] font-bold text-slate-500 uppercase leading-none">Score</span>
                        <span class="text-2xl font-black text-slate-800 leading-none" id="scoreDisplay">0</span>
                    </div>
                </div>
                <div
                    class="flex items-center gap-3 bg-white/90 px-6 py-3 rounded-full shadow-lg border-2 border-primary/20">
                    <span class="material-symbols-outlined text-primary text-3xl">timer</span>
                    <div class="flex flex-col">
                        <span class="text-[10px] font-bold text-slate-500 uppercase leading-none">Time</span>
                        <span class="text-2xl font-black text-slate-800 leading-none" id="timerDisplay">60</span>
                    </div>
                </div>
            </div>
        </header>

        <!-- Decoration Clouds -->
        <div class="absolute top-40 left-10 opacity-60 pointer-events-none transition-transform duration-[20s] linear-move"
            style="--move-x: 100vw">
            <span class="material-symbols-outlined text-[120px] text-white">cloud</span>
        </div>
        <div class="absolute top-20 right-40 opacity-40 pointer-events-none">
            <span class="material-symbols-outlined text-[180px] text-white">cloud</span>
        </div>

        <main class="flex-1 relative w-full h-full overflow-hidden" id="canvas">
            <!-- Balloons will spawn here -->
        </main>

        <footer class="relative z-20 p-8 flex items-center justify-center">
            <div
                class="w-full max-w-2xl bg-white/20 backdrop-blur-md p-4 rounded-full border border-white/30 flex items-center gap-6 shadow-xl">
                <span class="text-white font-bold whitespace-nowrap px-4">Level Progress</span>
                <div class="flex-1 h-4 bg-black/10 rounded-full overflow-hidden border border-white/10">
                    <div class="h-full bg-white rounded-full transition-all duration-500 shadow-[0_0_15px_rgba(255,255,255,0.8)]"
                        id="progressBar" style="width: 0%;"></div>
                </div>
                <span class="text-white font-black px-4" id="progressText">0%</span>
            </div>
        </footer>

        <!-- SUMMARY SCREEN -->
        <div id="summaryScreen"
            class="fixed inset-0 bg-sky-blue/90 z-[100] flex items-center justify-center p-4 hidden">
            <div class="relative w-full max-w-2xl flex flex-col items-center">
                <div class="absolute -top-20 inset-x-0 flex justify-around pointer-events-none">
                    <span class="material-symbols-outlined text-primary text-4xl rotate-12">celebration</span>
                    <span class="material-symbols-outlined text-yellow-500 text-3xl -rotate-12">star</span>
                    <span class="material-symbols-outlined text-game-blue text-4xl rotate-45">filter_vintage</span>
                    <span class="material-symbols-outlined text-game-green text-3xl rotate-12">pentagon</span>
                </div>
                <div
                    class="w-full bg-wood-light border-8 border-wood-dark shadow-[0_20px_0_0_#92400e] rounded-xl p-8 flex flex-col items-center wood-texture-plank floating relative">
                    <div class="absolute -top-12 left-10 w-4 h-16 bg-stone-600 rounded-full border-2 border-stone-800">
                    </div>
                    <div class="absolute -top-12 right-10 w-4 h-16 bg-stone-600 rounded-full border-2 border-stone-800">
                    </div>

                    <div class="flex gap-4 mb-6">
                        <span class="material-symbols-outlined text-7xl text-yellow-400 drop-shadow-lg"
                            style="font-variation-settings: 'FILL' 1">grade</span>
                        <span class="material-symbols-outlined text-8xl text-yellow-400 -mt-6 drop-shadow-xl"
                            style="font-variation-settings: 'FILL' 1">grade</span>
                        <span class="material-symbols-outlined text-7xl text-yellow-400 drop-shadow-lg"
                            style="font-variation-settings: 'FILL' 1">grade</span>
                    </div>

                    <h1 class="text-white text-6xl font-black mb-8 bubbly-text tracking-tight uppercase"
                        id="finishTitle">Well Done!</h1>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 w-full mb-10">
                        <div class="bg-white/20 border-4 border-white/30 rounded-lg p-6 text-center shadow-inner">
                            <p class="text-wood-dark text-lg font-bold uppercase tracking-wider">Balloons Popped</p>
                            <p class="text-white text-5xl font-black" id="finalPoppedCount">0</p>
                        </div>
                        <div class="bg-white/20 border-4 border-white/30 rounded-lg p-6 text-center shadow-inner">
                            <p class="text-wood-dark text-lg font-bold uppercase tracking-wider">Total Score</p>
                            <p class="text-white text-5xl font-black" id="finalScore">0</p>
                        </div>
                    </div>

                    <div id="highScoreBadge"
                        class="bg-primary/90 border-4 border-white rounded-full px-8 py-3 mb-8 shadow-lg transform -rotate-2 hidden">
                        <p class="text-white text-xl font-bold">New High Score! üèÜ</p>
                    </div>

                    <div class="flex flex-col sm:flex-row gap-6 w-full px-4">
                        <button onclick="location.reload()"
                            class="flex-1 bg-game-green hover:bg-green-600 text-white rounded-full py-6 px-8 flex items-center justify-center gap-3 transition-all active:translate-y-2 shadow-[0_10px_0_0_#166534] group">
                            <span
                                class="material-symbols-outlined text-4xl group-hover:rotate-180 transition-transform duration-500">refresh</span>
                            <span class="text-2xl font-black uppercase tracking-tight">Play Again</span>
                        </button>
                        <button onclick="window.location.href='index.html'"
                            class="flex-1 bg-game-blue hover:bg-blue-600 text-white rounded-full py-6 px-8 flex items-center justify-center gap-3 transition-all active:translate-y-2 shadow-[0_10px_0_0_#1e40af] group">
                            <span class="material-symbols-outlined text-4xl">home</span>
                            <span class="text-2xl font-black uppercase tracking-tight">Home</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <script>
        const letters = "ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("");
        const balloonColors = [
            "bg-red-500", "bg-blue-500", "bg-yellow-400", "bg-green-500",
            "bg-purple-500", "bg-orange-500", "bg-pink-500"
        ];

        let score = 0;
        let poppedCount = 0;
        let timeLeft = 60;
        let gameActive = false;
        let targetLetter = "A";
        let spawnInterval;
        let timerInterval;

        const canvas = document.getElementById('canvas');
        const scoreDisplay = document.getElementById('scoreDisplay');
        const timerDisplay = document.getElementById('timerDisplay');
        const targetLetterDisplay = document.getElementById('targetLetterDisplay');
        const progressBar = document.getElementById('progressBar');
        const progressText = document.getElementById('progressText');
        const speakerBtn = document.getElementById('speakerBtn');

        function startGame() {
            document.getElementById('startScreen').classList.add('hidden');
            gameActive = true;
            score = 0;
            poppedCount = 0;
            timeLeft = 60;
            updateHUD();
            setNewTarget();

            spawnInterval = setInterval(spawnBalloon, 800);
            timerInterval = setInterval(updateTimer, 1000);

            speak("Welcome to Balloon Pop! Pop the letter " + targetLetter);
        }

        function updateTimer() {
            if (!gameActive) return;
            timeLeft--;
            timerDisplay.innerText = timeLeft;

            let progress = ((60 - timeLeft) / 60) * 100;
            progressBar.style.width = progress + "%";
            progressText.innerText = Math.floor(progress) + "%";

            if (timeLeft <= 0) {
                endGame();
            }
        }

        function setNewTarget() {
            targetLetter = letters[Math.floor(Math.random() * letters.length)];
            targetLetterDisplay.innerText = targetLetter;
            speak("Find " + targetLetter);
        }

        function spawnBalloon() {
            if (!gameActive) return;

            const balloonWrapper = document.createElement('div');
            balloonWrapper.className = 'absolute bottom-[-150px] transition-all duration-1000 ease-linear hover:z-50';

            const randomX = Math.random() * 80 + 10;
            balloonWrapper.style.left = randomX + "%";

            const letter = Math.random() > 0.4 ? targetLetter : letters[Math.floor(Math.random() * letters.length)];
            const color = balloonColors[Math.floor(Math.random() * balloonColors.length)];

            balloonWrapper.innerHTML = `
                <div class="relative cursor-pointer transition-transform active:scale-90 balloon" onclick="popBalloon(this, '${letter}')">
                    <div class="w-32 h-40 ${color} rounded-full shadow-xl flex items-center justify-center border-4 border-white/20 relative overflow-hidden">
                        <div class="absolute top-2 left-4 w-6 h-10 bg-white/20 rounded-full rotate-12"></div>
                        <span class="text-white text-5xl font-black select-none">${letter}</span>
                    </div>
                    <div class="w-0.5 h-20 bg-white/40 mx-auto -mt-1"></div>
                </div>
            `;

            canvas.appendChild(balloonWrapper);

            // Animate float up
            const duration = 5000 + Math.random() * 3000;
            const anim = balloonWrapper.animate([
                { bottom: '-150px', transform: `translateX(0px)` },
                { bottom: '100%', transform: `translateX(${Math.random() * 100 - 50}px)` }
            ], {
                duration: duration,
                easing: 'linear'
            });

            anim.onfinish = () => balloonWrapper.remove();
        }

        function popBalloon(el, letter) {
            if (!gameActive) return;

            const parent = el.closest('.absolute');

            if (letter === targetLetter) {
                score += 100;
                poppedCount++;
                confetti({
                    particleCount: 20,
                    spread: 40,
                    origin: {
                        x: parent.offsetLeft / window.innerWidth,
                        y: parent.offsetTop / window.innerHeight
                    }
                });
                speak("Great!");
                setNewTarget();
            } else {
                score = Math.max(0, score - 50);
                speak("Oops!");
            }

            updateHUD();

            // Pop effect
            el.classList.add('pop-animation');
            setTimeout(() => parent.remove(), 300);
        }

        function updateHUD() {
            scoreDisplay.innerText = score;
        }

        function endGame() {
            gameActive = false;
            clearInterval(spawnInterval);
            clearInterval(timerInterval);

            document.getElementById('summaryScreen').classList.remove('hidden');
            document.getElementById('finalPoppedCount').innerText = poppedCount;
            document.getElementById('finalScore').innerText = score;

            speak("Well done! You popped " + poppedCount + " balloons!");

            confetti({
                particleCount: 150,
                spread: 70,
                origin: { y: 0.6 }
            });
        }

        speakerBtn.onclick = () => speak("Pop the letter " + targetLetter);

        // Initial voice load fix
        window.speechSynthesis.getVoices();
    </script>
</body>

</html>